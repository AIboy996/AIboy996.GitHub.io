---
tags:
- 爬虫
- python案例
---

# 获取地方药监局官网上的GSP认证信息
> GSP认证又叫**药品经营质量管理规范认证**
> 
> GMP认证又叫**药品生产质量管理规范认证**
> 
> 有的网站会用中文名

## 进度


!!! question "各省药监局网"
    - [x] [北京市❌](http://yjj.beijing.gov.cn/)
    - [x] [天津市❌](http://scjg.tj.gov.cn/)
    - [x] [河北省❓](http://yjj.hebei.gov.cn/)
      - http://yjj.hebei.gov.cn/datasearch/face3/dir_html_new.jsp
      - 服务器G了
    - [x] [山西省❌](http://yjj.shanxi.gov.cn)
      - https://yjj.shanxi.gov.cn/sjcx/
      - 没GSP接口
    - [x] [内蒙古❌](http://mpa.nmg.gov.cn)
      - http://110.16.70.4:9240/online/
      - 没GSP接口
    - [x] [辽宁省❌](http://ypjg.ln.gov.cn/)
      - https://ypjg.ln.gov.cn/ypjg/sjcx/sjsjzx/index.shtml
      - 没GSP接口
    - [x] [吉林省❌](http://mpa.JL.gov.cn)
      - http://mpa.jl.gov.cn/gzfw/sjcx/yp/
      - 没GSP接口
    - [x] [黑龙江省❌](http://mpa.hlj.gov.cn/)
      - https://221.208.28.172:9443/sjcx
      - 没GSP接口
    - [x] [上海市✔️](http://yjj.sh.gov.cn/)
    - [x] [江苏省✔️](http://da.jiangsu.gov.cn/)
    - [x] [浙江省❌](http://mpa.zj.gov.cn/)
      - http://mpa.zj.gov.cn/col/col1228990181/index.html
      - 没GSP接口
    - [x] [安徽省❌](http://mpa.ah.gov.cn)
      - https://mpa.ah.gov.cn/sjcx/sjcx/index.html
      - 没GSP接口
    - [x] [福建省✔️](http://yjj.scjgj.fujian.gov.cn/default.htm)
    - [ ] [江西省](http://mpa.jiangxi.gov.cn/)
    - [ ] [山东省](http://mpa.shandong.gov.cn)
    - [ ] [河南省](http://yjj.henan.gov.cn/)
    - [x] [湖北省✔️](http://mpa.hubei.gov.cn/)
    - [ ] [湖南省](http://mpa.hunan.gov.cn/)
    - [ ] [广东省](http://mpa.gd.gov.cn/)
    - [ ] [广西区](http://yjj.gxzf.gov.cn/)
    - [ ] [海南省](http://amr.hainan.gov.cn/himpa/)
    - [ ] [重庆市](http://yaojianju.cq.gov.cn/)
    - [ ] [四川省](http://yjj.sc.gov.cn/)
    - [ ] [贵州省](http://yjj.guizhou.gov.cn/)
    - [ ] [云南省](http://mpa.yn.gov.cn/)
    - [ ] [西藏自治区](http://mpa.xizang.gov.cn/)
    - [ ] [陕西省](http://mpa.shaanxi.gov.cn/)
    - [ ] [甘肃省](http://yjj.gansu.gov.cn)
    - [ ] [青海省](http://ypjgj.qinghai.gov.cn/)
    - [ ] [新疆区](http://mpa.xinjiang.gov.cn/)
    - [ ] [宁夏区](http://nxyjj.nx.gov.cn)

## 湖北省

[药品GSP认证证书](https://59.175.169.148:8999/wssb/websearch/SearchCardAction.do?operate=searchGyEntCard&operPage=card_ypgsp_list&cardtype=18)

![image-20230228154637849](assets/image-20230228154637849.png)

### 解决方案
- 使用POST请求下面的网址

https://59.175.169.148:8999/wssb/websearch/SearchCardAction.do?operate=searchGyEntCard&operPage=card_ypgsp_list&cardtype=18&pageModel.afreshQuery=true

POST参数为：

```python
data={
        'gyEntcardprint.cardid': '',
        'gyEntcardprint.name': '',
        'pageModel.nextPageNo': '1', # 页码
        'pageModel.pageSize': '12', # 似乎不可变
        'cardtype': '18' # 意义不明，没试出来除了18之外其他可用的取值
    }
```

得到特定页码的页面，然后在页面上即可获取每个GSP认证的id，形如：`8a85036169e1fc6e016a4cd372ae288c`

- 带着上面获取到的ID，使用GET请求下面的网址

https://59.175.169.148:8999/wssb/websearch/SearchCardAction.do?operate=viewGyEntCard&operPage=card_ypgsp_view&recid=8a85036169e1fc6e016a4cd372ae288c

即可获得详细的数据。

## 上海市

[上海市获GSP认证证书企业名单](https://sjcx.yjj.sh.gov.cn/#/gsp)

![image-20230228154648418](assets/image-20230228154648418.png)

### 解决方案

最简单的一种：

直接GET请求下面这个网址就会返回json格式的数据了

https://sjcx.yjj.sh.gov.cn/api/v1/gsp/list?pageNum=1&pageSize=500&_t=1677571296

这里面`pageNum`是页码，`pageSize`是每页的数据量（最大可以设置到500），`_t`是时间戳。

## 江苏省

[药品经营企业GSP认证](https://zwpt.da.jiangsu.gov.cn/datacenter/dc/list/9ef795a57980417cb24c274d67059910?pageNo=1)

![image-20230228154754970](assets/image-20230228154754970.png)

和湖北省类似。

## 福建省
[许可信息查询](https://zxsb.fjmpa.cn:8070/webSiteController/view.do?navTarget=website/xkcx/xkcx_search&tabFlag=drug&typeFlag=druggsp)

![image-20230301114038261](assets/image-20230301114038261.png)


一句话就爬完了，真是个讨喜的网站
```python
import requests
import pandas as pd
import json

df = pd.DataFrame(json.loads(
        requests.post(
        "https://zxsb.fjmpa.cn:8070/safesocialPermissionController/xzxkListEasyUI.do?xktype=12",
        headers={
            "User-Agent":'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 \
                (KHTML, like Gecko) Chrome/110.0.0.0 Safari/537.36'
        },
        data={
            'page' : '1',
            'rows' : '958' # 一共958个数据，可以一次性请求
        }
    ).text)['rows']).set_index('CURRENTROW')
```